<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="VP">
    <meta name="description" content="VP Corrugation Calculator">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="images/icon-192x192.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/icon-192x192.png">
    <title>Corrugation Calculator</title>
    <style>
        /* Base Styles */
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f9fafb;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
        }

        /* Title and Progress Bar Styles */
        .page-title {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
            background: linear-gradient(to right, #2563eb, #3b82f6);
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .interactive-title {
            position: relative;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            padding: 8px;
            transition: opacity 0.3s ease;
        }

        .interactive-title:active {
            opacity: 0.8;
        }

        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.9);
            width: 0;
            transition: width 0.1s linear;
            border-radius: 2px;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-header {
            background: #f8fafc;
            padding: 15px 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .card-title {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            text-transform: uppercase;
        }

        .card-content {
            padding: 20px;
        }

        /* Form Layout */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .space-y-2 {
            margin-bottom: 16px;
        }

        /* Form Elements */
        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 4px;
            color: #374151;
        }

        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        /* Result Display */
        .result {
            background: #eff6ff;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .result p {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
        }
</style>
</head>
<body>
    <div class="container">
        <div class="page-title interactive-title">
            Corrugation Calculator
            <div class="progress-bar"></div>
        </div>

        <!-- Top Paper Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Top Paper</h2>
            </div>
            <div class="card-content">
                <div class="grid">
                    <div class="space-y-2">
                        <label>Reel No</label>
                        <input type="text" id="topReelNo">
                    </div>
                    <div class="space-y-2">
                        <label>GSM</label>
                        <select id="topGsm">
                            <option value="100">100</option>
                            <option value="120">120</option>
                            <option value="140">140</option>
                            <option value="150">150</option>
                            <option value="180">180</option>
                            <option value="200">200</option>
                            <option value="220">220</option>
                            <option value="240">240</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label>Initial Weight (kg)</label>
                        <input type="number" id="topInitialWeight" step="0.01">
                    </div>
                    <div class="space-y-2">
                        <label>Reel Size</label>
                        <input type="number" id="topReelSize" step="0.01">
                    </div>
                </div>
                <div class="result">
                    <p>Final Weight: <span id="topFinalWeight">0.00</span> kg</p>
                </div>
            </div>
        </div>
		<!-- Fluting Medium Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Fluting Medium</h2>
            </div>
            <div class="card-content">
                <div class="grid">
                    <div class="space-y-2">
                        <label>Reel No</label>
                        <input type="text" id="flutingReelNo">
                    </div>
                    <div class="space-y-2">
                        <label>GSM</label>
                        <select id="flutingGsm">
                            <option value="100">100</option>
                            <option value="120">120</option>
                            <option value="140">140</option>
                            <option value="150">150</option>
                            <option value="180">180</option>
                            <option value="200">200</option>
                            <option value="220">220</option>
                            <option value="240">240</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label>Initial Weight (kg)</label>
                        <input type="number" id="flutingInitialWeight" step="0.01">
                    </div>
                    <div class="space-y-2">
                        <label>Reel Size</label>
                        <input type="number" id="flutingReelSize" step="0.01">
                    </div>
                </div>
                <div class="result">
                    <p>Final Weight: <span id="flutingFinalWeight">0.00</span> kg</p>
                </div>
            </div>
        </div>

        <!-- Sheet Calculation Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Sheet Calculation</h2>
            </div>
            <div class="card-content">
                <div class="grid">
                    <div class="space-y-2">
                        <label>Cutting Size</label>
                        <input type="number" id="cuttingSize" step="0.01">
                    </div>
                    <div class="space-y-2">
                        <label>Number of Sheets</label>
                        <input type="number" id="numSheets" step="1">
                    </div>
                </div>
            </div>
        </div>

        <!-- Roll Weights Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Roll Weights</h2>
            </div>
            <div class="card-content">
                <div id="rollWeightsContainer">
                    <!-- Roll weights will be dynamically added here -->
                </div>
                <button class="add-roll" onclick="addRollWeight()">Add Roll</button>
            </div>
        </div>

        <!-- Action Buttons -->
        <button class="calculate" onclick="calculateFinalWeights()">Calculate Weights</button>
        <button onclick="saveCalculation()">Save Calculation</button>

        <!-- Saved Calculations -->
        <div class="card saved-calculations">
            <div class="card-header">
                <h2 class="card-title">Saved Calculations</h2>
            </div>
            <div class="card-content">
                <div id="savedCalculationsContainer"></div>
            </div>
        </div>
    </div>

    <style>
        /* Button Styles */
        button {
            width: 100%;
            padding: 12px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
        }

        button:hover {
            background: #1d4ed8;
        }

        button.add-roll {
            background: #3b82f6;
        }

        button.calculate {
            background: #22c55e;
            font-size: 1.125rem;
            padding: 16px;
        }

        /* Saved Calculations Styles */
        .calculation-group {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 16px;
        }

        .calculation-date {
            background: #f8fafc;
            padding: 12px 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calculation-item {
            padding: 16px;
            border-top: 1px solid #e5e7eb;
            display: none;
        }

        .calculation-item.show {
            display: block;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .detail-section {
            background: #f8fafc;
            padding: 12px;
            border-radius: 4px;
        }

        .detail-section h3 {
            margin: 0 0 8px 0;
            font-size: 1rem;
            color: #1f2937;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .detail-label {
            color: #6b7280;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .share-btn {
            background: #3b82f6;
            padding: 4px 12px;
            width: auto;
        }

        .delete-btn {
            background: #ef4444;
            padding: 4px 12px;
            width: auto;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }
        }
		.calculation-date {
            display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 12px 16px;
		}

		.calculation-date .action-buttons {
			display: flex;
			gap: 8px;
		}

		.calculation-date .share-btn,
		.calculation-date .delete-btn {
			padding: 4px 8px;
			font-size: 0.875rem;
		}

		.calculation-date button:hover {
			opacity: 0.9;
		}
    </style>
	<script>
// Update checker and installer
let pressTimer;
let updateWorker = null;
let pressStartTime;
const PRESS_DURATION = 10000; // 10 seconds

// Function to check for updates
async function checkForUpdates() {
    try {
        const registration = await navigator.serviceWorker.register('sw.js');
        await registration.update();
        
        if (registration.waiting) {
            showUpdateDialog();
            return true;
        }
        
        registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            updateWorker = newWorker;
            
            newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    showUpdateDialog();
                }
            });
        });
        
        return false;
    } catch (error) {
        console.error('Error checking for updates:', error);
        return false;
    }
}

// Function to show update dialog
function showUpdateDialog() {
    if (confirm('A new version is available! Would you like to update?')) {
        if (updateWorker) {
            updateWorker.postMessage({ type: 'SKIP_WAITING' });
        }
        window.location.reload();
    }
}

function updateProgress() {
    if (pressStartTime) {
        const elapsedTime = Date.now() - pressStartTime;
        const progress = Math.min((elapsedTime / PRESS_DURATION) * 100, 100);
        const progressBar = document.querySelector('.progress-bar');
        if (progressBar) {
            progressBar.style.width = `${progress}%`;
            
            if (elapsedTime < PRESS_DURATION) {
                requestAnimationFrame(updateProgress);
            }
        }
    }
}

function startProgress() {
    pressStartTime = Date.now();
    const progressBar = document.querySelector('.progress-bar');
    if (progressBar) {
        progressBar.style.width = '0';
        updateProgress();
    }
}

function resetProgress() {
    const progressBar = document.querySelector('.progress-bar');
    if (progressBar) {
        progressBar.style.width = '0';
    }
    pressStartTime = null;
}

// Calculator core functions
let rollWeights = [''];

function addRollWeight() {
    rollWeights.push('');
    renderRollWeights();
}

function renderRollWeights() {
    const container = document.getElementById('rollWeightsContainer');
    container.innerHTML = rollWeights.map((weight, index) => `
        <div class="space-y-2">
            <label>Roll ${index + 1} Weight (kg)</label>
            <input 
                type="number" 
                step="0.01" 
                value="${weight}"
                onchange="updateRollWeight(${index}, this.value)"
            >
        </div>
    `).join('');
}

function updateRollWeight(index, value) {
    rollWeights[index] = value;
}

function calculateSingleSheetWeights() {
    const topReelSize = parseFloat(document.getElementById('topReelSize').value) || 0;
    const topGsm = parseFloat(document.getElementById('topGsm').value) || 0;
    const fluteReelSize = parseFloat(document.getElementById('flutingReelSize').value) || 0;
    const fluteGsm = parseFloat(document.getElementById('flutingGsm').value) || 0;

    const a = topReelSize ? (topReelSize * 39.4 * topGsm) / 1550000 : 0;
    const b = fluteReelSize ? (fluteReelSize * 39.4 * fluteGsm * 1.4) / 1550000 : 0;

    return { a, b };
}

function calculateSheetsFromRoll(rollWeight) {
    const g1 = parseFloat(document.getElementById('topGsm').value) || 0;
    const g2 = parseFloat(document.getElementById('flutingGsm').value) || 0;
    const l = parseFloat(document.getElementById('topReelSize').value) || 0;

    if (!l || !g1) return 0;

    const denominator = g2 ? (g1 + g2 * 1.4) : g1;
    return (rollWeight * 1550000) / (l * 39.4 * denominator);
}

function calculateRegularSheetWeights() {
    const cuttingSize = parseFloat(document.getElementById('cuttingSize').value) || 0;
    const numSheets = parseFloat(document.getElementById('numSheets').value) || 0;
    const topReelSize = parseFloat(document.getElementById('topReelSize').value) || 0;
    const topGsm = parseFloat(document.getElementById('topGsm').value) || 0;
    const fluteReelSize = parseFloat(document.getElementById('flutingReelSize').value) || 0;
    const fluteGsm = parseFloat(document.getElementById('flutingGsm').value) || 0;

    let topWeight = 0;
    let fluteWeight = 0;

    if (cuttingSize && numSheets) {
        if (topReelSize && topGsm) {
            topWeight = (topReelSize * cuttingSize * topGsm) / 1550000 * numSheets;
        }

        if (fluteReelSize && fluteGsm) {
            fluteWeight = (fluteReelSize * cuttingSize * fluteGsm * 1.4) / 1550000 * numSheets;
        }
    }

    return { topWeight, fluteWeight };
}

function calculateRollWeights() {
    const { a, b } = calculateSingleSheetWeights();
    let topWeight = 0;
    let fluteWeight = 0;

    rollWeights.forEach(weight => {
        if (weight) {
            const numSheets = calculateSheetsFromRoll(parseFloat(weight));
            topWeight += a * numSheets;
            fluteWeight += b * numSheets;
        }
    });

    return { topWeight, fluteWeight };
}

function calculateFinalWeights() {
    const regularWeights = calculateRegularSheetWeights();
    const rollWeights = calculateRollWeights();

    const topInitialWeight = parseFloat(document.getElementById('topInitialWeight').value) || 0;
    const fluteInitialWeight = parseFloat(document.getElementById('flutingInitialWeight').value) || 0;

    const topFinalWeight = topInitialWeight - (regularWeights.topWeight + rollWeights.topWeight);
    const fluteFinalWeight = fluteInitialWeight - (regularWeights.fluteWeight + rollWeights.fluteWeight);

    document.getElementById('topFinalWeight').textContent = topFinalWeight.toFixed(2);
    document.getElementById('flutingFinalWeight').textContent = fluteFinalWeight.toFixed(2);
}
</script>
<script>
// Saved calculations management
let savedCalculations = JSON.parse(localStorage.getItem('savedCalculations') || '[]');

function saveCalculation() {
    const calculation = {
        id: Date.now(),
        date: new Date().toLocaleDateString(),
        timestamp: new Date().toLocaleString(),
        topPaper: {
            reelNo: document.getElementById('topReelNo').value,
            gsm: document.getElementById('topGsm').value,
            initialWeight: document.getElementById('topInitialWeight').value,
            reelSize: document.getElementById('topReelSize').value,
            finalWeight: document.getElementById('topFinalWeight').textContent
        },
        flutingMedium: {
            reelNo: document.getElementById('flutingReelNo').value,
            gsm: document.getElementById('flutingGsm').value,
            initialWeight: document.getElementById('flutingInitialWeight').value,
            reelSize: document.getElementById('flutingReelSize').value,
            finalWeight: document.getElementById('flutingFinalWeight').textContent
        },
        sheetCalc: {
            cuttingSize: document.getElementById('cuttingSize').value,
            numSheets: document.getElementById('numSheets').value
        },
        rollWeights: [...rollWeights]
    };

    savedCalculations.unshift(calculation);
    localStorage.setItem('savedCalculations', JSON.stringify(savedCalculations));
    renderSavedCalculations();
}

function deleteCalculation(id) {
    if (confirm('Are you sure you want to delete this calculation?')) {
        savedCalculations = savedCalculations.filter(calc => calc.id !== id);
        localStorage.setItem('savedCalculations', JSON.stringify(savedCalculations));
        renderSavedCalculations();
    }
}

function groupCalculationsByDate() {
    const groups = {};
    savedCalculations.forEach(calc => {
        if (!groups[calc.date]) {
            groups[calc.date] = [];
        }
        groups[calc.date].push(calc);
    });
    return groups;
}

function formatCalculationText(calc) {
    return `Calculation Details (${calc.date})

Top Paper:
- Reel No: ${calc.topPaper.reelNo}
- GSM: ${calc.topPaper.gsm}
- Reel Size: ${calc.topPaper.reelSize}
- Initial Weight: ${calc.topPaper.initialWeight} kg
- Final Weight: ${calc.topPaper.finalWeight} kg

Fluting Medium:
- Reel No: ${calc.flutingMedium.reelNo}
- GSM: ${calc.flutingMedium.gsm}
- Reel Size: ${calc.flutingMedium.reelSize}
- Initial Weight: ${calc.flutingMedium.initialWeight} kg
- Final Weight: ${calc.flutingMedium.finalWeight} kg

Sheet Details:
- Cutting Size: ${calc.sheetCalc.cuttingSize}
- Number of Sheets: ${calc.sheetCalc.numSheets}

Roll Weights:
${calc.rollWeights.map((weight, index) => `Roll ${index + 1}: ${weight} kg`).join('\n')}`;
}

async function shareCalculation(calcData) {
    const calc = JSON.parse(calcData);
    const text = formatCalculationText(calc);
    
    if (navigator.share) {
        try {
            await navigator.share({
                title: 'Corrugation Calculation',
                text: text
            });
        } catch (err) {
            fallbackShare(text);
        }
    } else {
        fallbackShare(text);
    }
}

function deleteCalculation(id, buttonElement) {
    if (confirm('Are you sure you want to delete this calculation?')) {
        // Find the calculation group element
        const calculationItem = buttonElement.closest('.calculation-item');
        const calculationGroup = calculationItem.closest('.calculation-group');
        const isExpanded = calculationItem.classList.contains('show');
        
        // Remove the calculation
        savedCalculations = savedCalculations.filter(calc => calc.id !== id);
        localStorage.setItem('savedCalculations', JSON.stringify(savedCalculations));
        
        // Re-render but maintain expansion state
        renderSavedCalculations();
        
        if (isExpanded) {
            // Find and expand the same date group
            const dateHeader = calculationGroup.querySelector('.calculation-date');
            const newGroup = document.querySelector(`.calculation-date[data-date="${dateHeader.dataset.date}"]`);
            if (newGroup) {
                toggleCalculations(newGroup);
            }
        }
    }
}

async function shareCalculationsForDate(date) {
    const calculations = savedCalculations.filter(calc => calc.date === date);
    let text = `Calculations for ${date}\n\n`;
    calculations.forEach((calc, index) => {
        text += `--- Calculation ${calculations.length - index} ---\n`;
        text += formatCalculationText(calc) + '\n\n';
    });
    
    if (navigator.share) {
        try {
            await navigator.share({
                title: `Corrugation Calculations - ${date}`,
                text: text
            });
        } catch (err) {
            fallbackShare(text);
        }
    } else {
        fallbackShare(text);
    }
}

function deleteCalculationsForDate(date) {
    if (confirm(`Are you sure you want to delete all calculations for ${date}?`)) {
        savedCalculations = savedCalculations.filter(calc => calc.date !== date);
        localStorage.setItem('savedCalculations', JSON.stringify(savedCalculations));
        renderSavedCalculations();
    }
}

function renderSavedCalculations() {
    const container = document.getElementById('savedCalculationsContainer');
    const groups = groupCalculationsByDate();
    
    if (Object.keys(groups).length === 0) {
        container.innerHTML = '<p>No saved calculations</p>';
        return;
    }

    const html = Object.entries(groups).map(([date, calculations]) => `
        <div class="calculation-group">
            <div class="calculation-date" data-date="${date}" onclick="toggleCalculations(this)">
                <span>${date} (${calculations.length} calculation${calculations.length > 1 ? 's' : ''})</span>
                <div class="action-buttons">
                    <button class="share-btn" onclick="event.stopPropagation(); shareCalculationsForDate('${date}')" data-calculations='${JSON.stringify(calculations).replace(/'/g, "&apos;")}'>Share All</button>
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteCalculationsForDate('${date}')">Delete All</button>
                </div>
            </div>
            ${calculations.map((calc, index) => `
                <div class="calculation-item">
                    <h3>Calculation #${calculations.length - index}</h3>
                    <div class="detail-grid">
                        <div class="detail-section">
                            <h3>Top Paper</h3>
                            <div class="detail-item">
                                <span class="detail-label">Reel No:</span>
                                <span>${calc.topPaper.reelNo}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">GSM:</span>
                                <span>${calc.topPaper.gsm}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Reel Size:</span>
                                <span>${calc.topPaper.reelSize}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Initial Weight:</span>
                                <span>${calc.topPaper.initialWeight} kg</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Final Weight:</span>
                                <span>${calc.topPaper.finalWeight} kg</span>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Fluting Medium</h3>
                            <div class="detail-item">
                                <span class="detail-label">Reel No:</span>
                                <span>${calc.flutingMedium.reelNo}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">GSM:</span>
                                <span>${calc.flutingMedium.gsm}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Reel Size:</span>
                                <span>${calc.flutingMedium.reelSize}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Initial Weight:</span>
                                <span>${calc.flutingMedium.initialWeight} kg</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Final Weight:</span>
                                <span>${calc.flutingMedium.finalWeight} kg</span>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Sheet Details</h3>
                            <div class="detail-item">
                                <span class="detail-label">Cutting Size:</span>
                                <span>${calc.sheetCalc.cuttingSize}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Number of Sheets:</span>
                                <span>${calc.sheetCalc.numSheets}</span>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h3>Roll Weights</h3>
                            ${calc.rollWeights.map((weight, idx) => weight ? `
                                <div class="detail-item">
                                    <span class="detail-label">Roll ${idx + 1}:</span>
                                    <span>${weight} kg</span>
                                </div>
                            ` : '').join('')}
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="share-btn" data-calculation='${JSON.stringify(calc).replace(/'/g, "&apos;")}' onclick="shareCalculation(this.dataset.calculation)">Share</button>
                        <button class="delete-btn" onclick="deleteCalculation(${calc.id}, this)">Delete</button>
                    </div>
                </div>
            `).join('')}
        </div>
    `).join('');

    container.innerHTML = html;
}
</script>
<script>
// Toggle functionality for saved calculations
function toggleCalculations(element) {
    const items = element.parentElement.querySelectorAll('.calculation-item');
    items.forEach(item => {
        item.classList.toggle('show');
    });
}

// Event listeners
document.addEventListener('DOMContentLoaded', () => {
    // Initialize saved calculations
    renderSavedCalculations();
    renderRollWeights();

    // Update checker event listeners
    const titleElement = document.querySelector('.page-title');
    if (titleElement) {
        let isPressed = false;
        
        // Touch events for mobile
        titleElement.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isPressed = true;
            startProgress();
            pressTimer = setTimeout(() => {
                checkForUpdates();
                resetProgress();
            }, PRESS_DURATION);
        }, { passive: false });
        
        titleElement.addEventListener('touchend', () => {
            isPressed = false;
            clearTimeout(pressTimer);
            resetProgress();
        });
        
        // Mouse events for desktop
        titleElement.addEventListener('mousedown', (e) => {
            if (e.button === 2) {
                e.preventDefault();
                checkForUpdates();
                return;
            }
            
            isPressed = true;
            startProgress();
            pressTimer = setTimeout(() => {
                checkForUpdates();
                resetProgress();
            }, PRESS_DURATION);
        });
        
        titleElement.addEventListener('mouseup', () => {
            isPressed = false;
            clearTimeout(pressTimer);
            resetProgress();
        });
        
        titleElement.addEventListener('mouseleave', () => {
            if (isPressed) {
                isPressed = false;
                clearTimeout(pressTimer);
                resetProgress();
            }
        });
        
        // Prevent context menu
        titleElement.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });
    }
    
    // Keyboard shortcut (Ctrl + Shift + U)
    document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'u') {
            e.preventDefault();
            checkForUpdates();
        }
    });
    
    // Service Worker registration
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.addEventListener('controllerchange', () => {
            window.location.reload();
        });
    }
});

// Close body and html tags
</script>
</body>
</html>